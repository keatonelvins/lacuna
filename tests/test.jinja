{%- for message in messages -%}
    {%- if message.role == "assistant" -%}
        {{- '<|im_start|>' + message.role + '\n' }}
        {%- generation %}
            {{- message.content + '<|im_end|>' }}
        {%- endgeneration %}
        {{- '\n' }}
    {%- else -%}
        {{- '<|im_start|>' + message.role + '\n' + message.content + '<|im_end|>' + '\n' }}
    {%- endif -%}
{%- endfor -%}